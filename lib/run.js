// the main run command - run leasot and append the returned text to the readme

// requires and vars
var fs = require('fs');
var findInFiles = require('find-in-files');
const TITLE_MD = '# TODOs and FIXMEs generated by leasot-to-readme:\n';
var OUTPUT_FILE = 'README.md';
var sCustomTemplate = null;
var sTemplate;
var sContents;

// get leasot output:
var sLeasotOutput = function(callback) {
    execute("leasot *", function(sResults) {
        callback(sResults);
    });
}.then(writeOutput);

function writeOutput() {
  // template logic
  if (sCustomTemplate) {
    sTemplate = sCustomTemplate;
  } else {
    sTemplate = TITLE_MD
  }
  sContents = sTemplate + sLeasotOutput;

  // if we already wrote there, delete and replace

  // else, append sContents to README.md
  fs.appendFile(OUTPUT_FILE, sContents, function (err) {
    if (err) throw err;
    console.log('Leasot output written to ' + OUTPUT_FILE + ".");
  });
}
